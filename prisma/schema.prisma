// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id            Int       @id @default(autoincrement())
  username      String    @unique @db.VarChar(50)
  email         String    @unique @db.VarChar(100)
  password_hash String    @db.VarChar(255)
  full_name     String?   @db.VarChar(100)
  avatar        String?   @db.VarChar(255)
  role          UserRole  @default(user)
  status        UserStatus @default(active)
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  posts         Post[]
  media         Media[]
  feedback_replies Feedback[] @relation("FeedbackReplies")

  @@map("users")
}

model Category {
  id            Int       @id @default(autoincrement())
  name          String    @db.VarChar(100)
  slug          String    @unique @db.VarChar(100)
  description   String?   @db.Text
  parent_id     Int?
  display_order Int       @default(0)
  created_at    DateTime  @default(now())

  parent        Category?  @relation("CategoryHierarchy", fields: [parent_id], references: [id], onDelete: SetNull)
  children      Category[] @relation("CategoryHierarchy")
  posts         Post[]
  projects      Project[]

  @@map("categories")
}

model Post {
  id           Int        @id @default(autoincrement())
  title        String     @db.VarChar(255)
  slug         String     @unique @db.VarChar(255)
  content      String     @db.LongText
  excerpt      String?    @db.Text
  cover_image  String?    @db.VarChar(255)
  author_id    Int
  category_id  Int?
  status       PostStatus @default(draft)
  views        Int        @default(0)
  published_at DateTime?
  created_at   DateTime   @default(now())
  updated_at   DateTime   @updatedAt

  author       User       @relation(fields: [author_id], references: [id], onDelete: Cascade)
  category     Category?  @relation(fields: [category_id], references: [id], onDelete: SetNull)
  tags         PostTag[]

  @@index([slug])
  @@index([status])
  @@index([published_at])
  @@map("posts")
}

model Tag {
  id    Int    @id @default(autoincrement())
  name  String @unique @db.VarChar(50)
  slug  String @unique @db.VarChar(50)

  posts PostTag[]

  @@map("tags")
}

model PostTag {
  post_id Int
  tag_id  Int

  post Post @relation(fields: [post_id], references: [id], onDelete: Cascade)
  tag  Tag  @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@id([post_id, tag_id])
  @@map("post_tags")
}

model Slide {
  id            Int      @id @default(autoincrement())
  title         String?  @db.VarChar(255)
  description   String?  @db.Text
  image_url     String   @db.VarChar(255)
  link_url      String?  @db.VarChar(255)
  display_order Int      @default(0)
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  @@map("slides")
}

model Media {
  id            Int      @id @default(autoincrement())
  filename      String   @db.VarChar(255)
  original_name String   @db.VarChar(255)
  file_path     String   @db.VarChar(255)
  file_type     String?  @db.VarChar(50)
  file_size     Int?
  uploaded_by   Int?
  created_at    DateTime @default(now())

  uploader User? @relation(fields: [uploaded_by], references: [id], onDelete: SetNull)

  @@map("media")
}

model Setting {
  id               Int      @id @default(autoincrement())
  site_name        String   @default("Cổng Thông Tin Quy Hoạch Quốc Gia") @db.VarChar(255)
  site_logo        String?  @db.VarChar(500)
  site_favicon     String?  @db.VarChar(500)
  footer_about     String?  @db.Text
  contact_email    String?  @db.VarChar(100)
  contact_phone    String?  @db.VarChar(50)
  contact_address  String?  @db.VarChar(255)
  facebook_url     String?  @db.VarChar(255)
  youtube_url      String?  @db.VarChar(255)
  footer_copyright String?  @db.VarChar(255)
  updated_at       DateTime @updatedAt

  @@map("settings")
}

model Video {
  id            Int         @id @default(autoincrement())
  title         String      @db.VarChar(255)
  description   String?     @db.Text
  video_url     String      @db.VarChar(500)
  thumbnail_url String?     @db.VarChar(500)
  duration      String?     @db.VarChar(20)
  display_order Int         @default(0)
  status        VideoStatus @default(active)
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt

  @@index([status])
  @@index([display_order])
  @@map("videos")
}

model Project {
  id           Int           @id @default(autoincrement())
  title        String        @db.VarChar(255)
  slug         String        @unique @db.VarChar(255)
  description  String?       @db.Text
  content      String?       @db.LongText
  cover_image  String?       @db.VarChar(500)
  pdf_file     String?       @db.VarChar(500)
  category_id  Int?
  status       ProjectStatus @default(draft)
  published_at DateTime?
  views        Int           @default(0)
  created_at   DateTime      @default(now())
  updated_at   DateTime      @updatedAt

  category Category? @relation(fields: [category_id], references: [id], onDelete: SetNull)

  @@index([slug])
  @@index([status])
  @@index([published_at])
  @@map("projects")
}

model Feedback {
  id          Int            @id @default(autoincrement())
  name        String         @db.VarChar(100)
  email       String         @db.VarChar(100)
  phone       String?        @db.VarChar(20)
  subject     String         @db.VarChar(255)
  message     String         @db.Text
  admin_reply String?        @db.Text
  status      FeedbackStatus @default(pending)
  replied_at  DateTime?
  replied_by  Int?
  created_at  DateTime       @default(now())
  updated_at  DateTime       @updatedAt

  replier User? @relation("FeedbackReplies", fields: [replied_by], references: [id], onDelete: SetNull)

  @@index([status])
  @@index([created_at])
  @@map("feedback")
}

model About {
  id         Int      @id @default(autoincrement())
  content    String   @db.LongText
  image_url  String?  @db.VarChar(500)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("about")
}

// Enums
enum UserRole {
  admin
  editor
  user
}

enum UserStatus {
  active
  inactive
}

enum PostStatus {
  draft
  published
  archived
}

enum VideoStatus {
  active
  inactive
}

enum ProjectStatus {
  draft
  published
}

enum FeedbackStatus {
  pending
  answered
  archived
}
