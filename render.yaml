# Render.com Deployment Configuration
# Documentation: https://render.com/docs/render-yaml-spec

services:
  # MySQL Database Service
  - type: pserv
    name: my-app-db
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile.mysql
    envVars:
      - key: MYSQL_ROOT_PASSWORD
        generateValue: true
      - key: MYSQL_DATABASE
        value: my_app_db
      - key: MYSQL_USER
        value: my_app_user
      - key: MYSQL_PASSWORD
        generateValue: true

  # Next.js Web Service
  - type: web
    name: my-app
    env: node
    plan: free
    buildCommand: sh render-build.sh
    startCommand: sh render-start.sh
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromService:
          type: pserv
          name: my-app-db
          envVarKey: DATABASE_URL
      - key: NEXTAUTH_SECRET
        generateValue: true
      - key: NEXTAUTH_URL
        value: https://my-app.onrender.com
