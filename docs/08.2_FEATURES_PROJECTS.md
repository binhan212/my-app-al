# 08.2. FEATURES - PROJECTS MANAGEMENT

> ‚è±Ô∏è **Th·ªùi gian ƒë·ªçc**: 50-70 ph√∫t  
> üéØ **M·ª•c ti√™u**: Hi·ªÉu 100% t√≠nh nƒÉng qu·∫£n l√Ω d·ª± √°n (Projects Management)

---

## üìò M·ª§C L·ª§C

1. [T·ªïng quan Projects Management](#1-t·ªïng-quan-projects-management)
2. [Database Schema](#2-database-schema)
3. [API Routes](#3-api-routes)
4. [Admin UI Components](#4-admin-ui-components)
5. [Public UI Components](#5-public-ui-components)
6. [PDF File Upload](#6-pdf-file-upload)
7. [Differences vs Posts](#7-differences-vs-posts)
8. [Complete Workflow](#8-complete-workflow)

---

## 1. T·ªïng quan Projects Management

### 1.1. Ch·ª©c nƒÉng ch√≠nh

**Projects Management** qu·∫£n l√Ω c√°c d·ª± √°n/c√¥ng tr√¨nh v·ªõi t√≠nh nƒÉng ƒë·∫∑c bi·ªát:

```
‚úÖ Create   - T·∫°o d·ª± √°n m·ªõi
‚úÖ Read     - Xem danh s√°ch v√† chi ti·∫øt d·ª± √°n
‚úÖ Update   - Ch·ªânh s·ª≠a d·ª± √°n
‚úÖ Delete   - X√≥a d·ª± √°n
‚úÖ Upload   - Upload ·∫£nh cover + PDF files
‚úÖ Status   - Qu·∫£n l√Ω tr·∫°ng th√°i (draft/published)
‚úÖ Category - Ph√¢n lo·∫°i theo danh m·ª•c
‚úÖ PDF      - ƒê√≠nh k√®m file PDF t√†i li·ªáu d·ª± √°n
```

### 1.2. So s√°nh v·ªõi Posts

| Feature | Posts | Projects |
|---------|-------|----------|
| **Content** | Rich text, tin t·ª©c | M√¥ t·∫£ d·ª± √°n, c√¥ng tr√¨nh |
| **PDF File** | ‚ùå Kh√¥ng | ‚úÖ C√≥ |
| **Author** | ‚úÖ C√≥ (User) | ‚ùå Kh√¥ng |
| **Status** | draft/published/archived | draft/published |
| **Content Length** | Text | LongText (d√†i h∆°n) |
| **Use Case** | Blog, news | Portfolio, showcases |

### 1.3. C·∫•u tr√∫c Files

```
app/
  admin/projects/
    page.tsx                          # Trang qu·∫£n l√Ω d·ª± √°n (Admin)
  du-an/
    page.tsx                          # Danh s√°ch d·ª± √°n (Public)
    [slug]/
      page.tsx                        # Chi ti·∫øt d·ª± √°n (Public)
  api/projects/
    route.ts                          # GET (list), POST (create)
    [id]/
      route.ts                        # GET (detail), PUT (update), DELETE

components/
  admin/
    ProjectsTable.tsx                 # Table hi·ªÉn th·ªã danh s√°ch
    ProjectFormDialog.tsx             # Form t·∫°o/s·ª≠a d·ª± √°n
  projects/
    ProjectCard.tsx                   # Card hi·ªÉn th·ªã d·ª± √°n
    ProjectDetail.tsx                 # Chi ti·∫øt d·ª± √°n

lib/
  validations.ts                      # Zod schema cho Project
```

---

## 2. Database Schema

### 2.1. Project Model

```prisma
// prisma/schema.prisma
model Project {
  id           Int           @id @default(autoincrement())
  title        String        @db.VarChar(255)
  slug         String        @unique @db.VarChar(255)
  description  String?       @db.Text
  content      String?       @db.LongText          // D√†i h∆°n Post
  cover_image  String?       @db.VarChar(500)
  pdf_file     String?       @db.VarChar(500)      // ‚≠ê PDF file URL
  
  // Relationships
  category_id  Int?
  category     Category?     @relation(fields: [category_id], references: [id], onDelete: SetNull)
  
  // Status & Metadata
  status       ProjectStatus @default(draft)        // draft, published
  views        Int           @default(0)
  
  // Timestamps
  published_at DateTime?
  created_at   DateTime      @default(now())
  updated_at   DateTime      @updatedAt

  @@index([slug])
  @@index([status])
  @@index([published_at])
  @@map("projects")
}

enum ProjectStatus {
  draft
  published
}
```

### 2.2. Relationships

```
Project ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ belongs to ‚Üí Category (category_id)
```

**Kh√°c bi·ªát so v·ªõi Post**:
- ‚ùå **Kh√¥ng c√≥** author_id (d·ª± √°n l√† c·ªßa c√¥ng ty, kh√¥ng ph√¢n bi·ªát t√°c gi·∫£)
- ‚úÖ **C√≥** pdf_file (ƒë√≠nh k√®m t√†i li·ªáu d·ª± √°n)
- ‚úÖ **LongText** cho content (d·ª± √°n c√≥ n·ªôi dung d√†i h∆°n)

### 2.3. Key Fields

| Field | Type | M√¥ t·∫£ |
|-------|------|-------|
| `slug` | String | URL-friendly identifier |
| `description` | Text | M√¥ t·∫£ ng·∫Øn g·ªçn |
| `content` | LongText | N·ªôi dung chi ti·∫øt d·ª± √°n |
| `pdf_file` | String? | URL file PDF (brochure, t√†i li·ªáu) |
| `status` | Enum | `draft`, `published` |
| `views` | Int | S·ªë l∆∞·ª£t xem |

---

## 3. API Routes

### 3.1. GET /api/projects - List Projects

**File**: `app/api/projects/route.ts`

```typescript
export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url)
    const page = parseInt(searchParams.get('page') || '1')
    const limit = parseInt(searchParams.get('limit') || '20')
    const skip = (page - 1) * limit

    const [projects, total] = await Promise.all([
      db.project.findMany({
        include: {
          category: {
            select: { id: true, name: true }
          }
        },
        orderBy: { created_at: 'desc' },
        skip,
        take: limit
      }),
      db.project.count()
    ])

    return NextResponse.json({
      success: true,
      data: {
        projects,
        pagination: {
          page,
          limit,
          total,
          totalPages: Math.ceil(total / limit)
        }
      }
    })
  } catch (error) {
    console.error('Get projects error:', error)
    return NextResponse.json(
      { success: false, message: 'L·ªói server' },
      { status: 500 }
    )
  }
}
```

**Response Format**:
```json
{
  "success": true,
  "data": {
    "projects": [
      {
        "id": 1,
        "title": "D·ª± √°n Khu ƒë√¥ th·ªã m·ªõi",
        "slug": "du-an-khu-do-thi-moi",
        "description": "Khu ƒë√¥ th·ªã hi·ªán ƒë·∫°i v·ªõi ƒë·∫ßy ƒë·ªß ti·ªán √≠ch",
        "cover_image": "/uploads/projects/project1.jpg",
        "pdf_file": "/uploads/pdfs/project1.pdf",
        "status": "published",
        "views": 320,
        "category": {
          "id": 3,
          "name": "Khu ƒë√¥ th·ªã"
        }
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 15,
      "totalPages": 1
    }
  }
}
```

### 3.2. POST /api/projects - Create Project

**Authentication**: Required

```typescript
export async function POST(request: NextRequest) {
  try {
    const session = await auth()
    
    if (!session?.user) {
      return NextResponse.json(
        { success: false, message: 'Unauthorized' },
        { status: 401 }
      )
    }

    const body = await request.json()
    const validatedData = projectSchema.parse(body)

    const project = await db.project.create({
      data: {
        title: validatedData.title,
        description: validatedData.description || null,
        content: validatedData.content || null,
        cover_image: validatedData.cover_image || null,
        pdf_file: validatedData.pdf_file || null,
        category_id: validatedData.category_id || null,
        status: validatedData.status,
        published_at: validatedData.status === 'published' ? new Date() : null,
        slug: createSlug(validatedData.title),
      }
    })

    return NextResponse.json({
      success: true,
      data: project,
      message: 'ƒê√£ t·∫°o d·ª± √°n m·ªõi'
    }, { status: 201 })
  } catch (error) {
    console.error('Create project error:', error)
    return NextResponse.json(
      { success: false, message: 'L·ªói server' },
      { status: 500 }
    )
  }
}
```

**Request Body**:
```json
{
  "title": "D·ª± √°n Khu ƒë√¥ th·ªã m·ªõi",
  "description": "Khu ƒë√¥ th·ªã hi·ªán ƒë·∫°i",
  "content": "N·ªôi dung chi ti·∫øt d·ª± √°n...",
  "cover_image": "/uploads/projects/image.jpg",
  "pdf_file": "/uploads/pdfs/brochure.pdf",
  "category_id": 3,
  "status": "published"
}
```

### 3.3. PUT /api/projects/[id] - Update Project

```typescript
export async function PUT(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await auth()
    if (!session?.user) {
      return NextResponse.json(
        { success: false, message: 'Unauthorized' },
        { status: 401 }
      )
    }

    const { id } = await params
    const body = await request.json()
    const validatedData = projectSchema.parse(body)

    const existingProject = await db.project.findUnique({
      where: { id: parseInt(id) }
    })

    if (!existingProject) {
      return NextResponse.json(
        { success: false, message: 'Kh√¥ng t√¨m th·∫•y d·ª± √°n' },
        { status: 404 }
      )
    }

    const project = await db.project.update({
      where: { id: parseInt(id) },
      data: {
        title: validatedData.title,
        description: validatedData.description || null,
        content: validatedData.content || null,
        cover_image: validatedData.cover_image || null,
        pdf_file: validatedData.pdf_file || null,
        category_id: validatedData.category_id || null,
        status: validatedData.status,
        slug: createSlug(validatedData.title),
        published_at: 
          validatedData.status === 'published' && existingProject.status !== 'published'
            ? new Date()
            : existingProject.published_at,
      }
    })

    return NextResponse.json({
      success: true,
      data: project,
      message: 'ƒê√£ c·∫≠p nh·∫≠t d·ª± √°n'
    })
  } catch (error) {
    console.error('Update project error:', error)
    return NextResponse.json(
      { success: false, message: 'L·ªói server' },
      { status: 500 }
    )
  }
}
```

### 3.4. DELETE /api/projects/[id] - Delete Project

```typescript
export async function DELETE(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await auth()
    if (!session?.user) {
      return NextResponse.json(
        { success: false, message: 'Unauthorized' },
        { status: 401 }
      )
    }

    const { id } = await params

    await db.project.delete({
      where: { id: parseInt(id) }
    })

    return NextResponse.json({
      success: true,
      message: 'ƒê√£ x√≥a d·ª± √°n'
    })
  } catch (error) {
    console.error('Delete project error:', error)
    return NextResponse.json(
      { success: false, message: 'L·ªói server' },
      { status: 500 }
    )
  }
}
```

---

## 4. Admin UI Components

### 4.1. ProjectsTable Component

**File**: `components/admin/ProjectsTable.tsx`

**Ch·ª©c nƒÉng**:
- Hi·ªÉn th·ªã danh s√°ch d·ª± √°n d·∫°ng table
- N√∫t "T·∫°o d·ª± √°n m·ªõi"
- Actions: Edit, Delete
- Hi·ªÉn th·ªã icon PDF n·∫øu c√≥ file ƒë√≠nh k√®m
- Link xem d·ª± √°n public

**Code Structure**:

```tsx
'use client'

import { useState } from 'react'
import Link from 'next/link'
import { Button } from '@/components/ui/button'
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'
import { Badge } from '@/components/ui/badge'
import { DocumentTextIcon, PlusIcon } from '@heroicons/react/24/outline'
import { ProjectFormDialog } from './ProjectFormDialog'

type ProjectWithRelations = Project & {
  category: Pick<Category, 'id' | 'name'> | null
}

interface ProjectsTableProps {
  projects: ProjectWithRelations[]
  categories: Category[]
  currentPage: number
  totalPages: number
}

export function ProjectsTable({ projects, categories, currentPage, totalPages }: ProjectsTableProps) {
  const [isCreateOpen, setIsCreateOpen] = useState(false)
  const [editingProject, setEditingProject] = useState<Project | null>(null)
  const [deletingProject, setDeletingProject] = useState<Project | null>(null)

  return (
    <div className="space-y-4">
      {/* Create Button */}
      <div className="flex justify-end">
        <Button onClick={() => setIsCreateOpen(true)}>
          <PlusIcon className="w-4 h-4 mr-2" />
          T·∫°o d·ª± √°n m·ªõi
        </Button>
      </div>

      {/* Table */}
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>Ti√™u ƒë·ªÅ</TableHead>
            <TableHead>Danh m·ª•c</TableHead>
            <TableHead>PDF</TableHead>
            <TableHead>Tr·∫°ng th√°i</TableHead>
            <TableHead>L∆∞·ª£t xem</TableHead>
            <TableHead>Ng√†y t·∫°o</TableHead>
            <TableHead className="text-right">H√†nh ƒë·ªông</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {projects.map((project) => (
            <TableRow key={project.id}>
              <TableCell className="font-medium">
                <Link href={`/du-an/${project.slug}`} target="_blank">
                  {project.title}
                </Link>
              </TableCell>
              <TableCell>{project.category?.name || '‚Äî'}</TableCell>
              <TableCell>
                {/* PDF Icon Link */}
                {project.pdf_file ? (
                  <a 
                    href={project.pdf_file} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    className="flex items-center gap-1 text-blue-600 hover:underline"
                  >
                    <DocumentTextIcon className="w-4 h-4" />
                    PDF
                  </a>
                ) : (
                  '‚Äî'
                )}
              </TableCell>
              <TableCell>
                <Badge variant={project.status === 'published' ? 'default' : 'secondary'}>
                  {project.status === 'published' ? 'ƒê√£ xu·∫•t b·∫£n' : 'Nh√°p'}
                </Badge>
              </TableCell>
              <TableCell>{project.views}</TableCell>
              <TableCell>{formatDate(project.created_at)}</TableCell>
              <TableCell>
                <DropdownMenu>
                  <DropdownMenuItem onClick={() => setEditingProject(project)}>
                    Ch·ªânh s·ª≠a
                  </DropdownMenuItem>
                  <DropdownMenuItem onClick={() => setDeletingProject(project)}>
                    X√≥a
                  </DropdownMenuItem>
                </DropdownMenu>
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>

      {/* Dialogs */}
      <ProjectFormDialog
        open={isCreateOpen}
        onOpenChange={setIsCreateOpen}
        categories={categories}
        onSuccess={() => window.location.reload()}
      />
    </div>
  )
}
```

**ƒêi·ªÉm kh√°c bi·ªát so v·ªõi PostsTable**:
- ‚úÖ Column "PDF" v·ªõi icon `DocumentTextIcon`
- ‚úÖ Kh√¥ng c√≥ column "T√°c gi·∫£"
- ‚úÖ Link PDF m·ªü tab m·ªõi

### 4.2. ProjectFormDialog Component

**File**: `components/admin/ProjectFormDialog.tsx`

**Ch·ª©c nƒÉng**:
- Form t·∫°o/s·ª≠a d·ª± √°n trong Dialog
- Upload ·∫£nh cover
- **Upload PDF file** (kh√°c v·ªõi Posts)
- Select category
- Textarea cho description v√† content
- Validation v·ªõi Zod

**Code Structure**:

```tsx
'use client'

import { useState, useEffect } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { Dialog, DialogContent } from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import { Select } from '@/components/ui/select'
import { DocumentTextIcon } from '@heroicons/react/24/outline'

const projectFormSchema = z.object({
  title: z.string().min(1, 'Ti√™u ƒë·ªÅ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng').max(255),
  description: z.string().max(500).optional(),
  content: z.string().optional(),
  cover_image: z.string().optional(),
  pdf_file: z.string().optional(),
  category_id: z.string().nullable().optional(),
  status: z.enum(['draft', 'published']),
})

type ProjectFormData = z.infer<typeof projectFormSchema>

export function ProjectFormDialog({ open, onOpenChange, project, categories, onSuccess }) {
  const [isUploadingImage, setIsUploadingImage] = useState(false)
  const [isUploadingPdf, setIsUploadingPdf] = useState(false)
  const [previewImage, setPreviewImage] = useState<string | null>(null)

  const { register, handleSubmit, formState: { errors }, setValue, watch } = useForm<ProjectFormData>({
    resolver: zodResolver(projectFormSchema),
  })

  const pdfFile = watch('pdf_file')

  // Image Upload Handler
  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    setIsUploadingImage(true)
    try {
      const formData = new FormData()
      formData.append('file', file)
      formData.append('type', 'projects')  // Upload v√†o /uploads/projects/

      const response = await fetch('/api/upload', {
        method: 'POST',
        body: formData,
      })

      const result = await response.json()
      setValue('cover_image', result.data.url)
      setPreviewImage(result.data.url)
      
      toast({
        title: 'Th√†nh c√¥ng',
        description: 'ƒê√£ upload ·∫£nh b√¨a',
        variant: 'success',
      })
    } catch (error) {
      toast({
        title: 'L·ªói',
        description: 'Upload ·∫£nh th·∫•t b·∫°i',
        variant: 'destructive',
      })
    } finally {
      setIsUploadingImage(false)
    }
  }

  // PDF Upload Handler (‚≠ê ƒêi·ªÉm kh√°c bi·ªát)
  const handlePdfUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    // Validate file type
    if (file.type !== 'application/pdf') {
      toast({
        title: 'L·ªói',
        description: 'Ch·ªâ ch·∫•p nh·∫≠n file PDF',
        variant: 'destructive',
      })
      return
    }

    // Validate file size (max 10MB)
    if (file.size > 10 * 1024 * 1024) {
      toast({
        title: 'L·ªói',
        description: 'File PDF kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 10MB',
        variant: 'destructive',
      })
      return
    }

    setIsUploadingPdf(true)
    try {
      const formData = new FormData()
      formData.append('file', file)
      formData.append('type', 'pdfs')  // Upload v√†o /uploads/pdfs/

      const response = await fetch('/api/upload', {
        method: 'POST',
        body: formData,
      })

      if (!response.ok) throw new Error('Upload failed')

      const result = await response.json()
      setValue('pdf_file', result.data.url)
      
      toast({
        title: 'Th√†nh c√¥ng',
        description: 'ƒê√£ upload file PDF',
        variant: 'success',
      })
    } catch (error) {
      toast({
        title: 'L·ªói',
        description: 'Upload PDF th·∫•t b·∫°i',
        variant: 'destructive',
      })
    } finally {
      setIsUploadingPdf(false)
    }
  }

  const onSubmit = async (data: ProjectFormData) => {
    // Same as Posts
    const payload = {
      ...data,
      category_id: data.category_id ? parseInt(data.category_id) : null,
    }

    const url = project ? `/api/projects/${project.id}` : '/api/projects'
    const method = project ? 'PUT' : 'POST'

    await fetch(url, {
      method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    })

    onSuccess()
    onOpenChange(false)
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-3xl max-h-[90vh] overflow-y-auto">
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          {/* Title */}
          <div>
            <Label>Ti√™u ƒë·ªÅ d·ª± √°n</Label>
            <Input {...register('title')} placeholder="VD: Khu ƒë√¥ th·ªã m·ªõi..." />
            {errors.title && <p className="text-sm text-red-500">{errors.title.message}</p>}
          </div>

          {/* Description */}
          <div>
            <Label>M√¥ t·∫£ ng·∫Øn</Label>
            <Textarea {...register('description')} rows={3} placeholder="M√¥ t·∫£ t√≥m t·∫Øt d·ª± √°n..." />
          </div>

          {/* Content */}
          <div>
            <Label>N·ªôi dung chi ti·∫øt</Label>
            <Textarea {...register('content')} rows={8} placeholder="N·ªôi dung ƒë·∫ßy ƒë·ªß v·ªÅ d·ª± √°n..." />
          </div>

          {/* Cover Image Upload */}
          <div>
            <Label>·∫¢nh b√¨a d·ª± √°n</Label>
            <Input 
              type="file" 
              accept="image/*" 
              onChange={handleImageUpload} 
              disabled={isUploadingImage} 
            />
            {isUploadingImage && <p className="text-sm text-gray-500">ƒêang upload...</p>}
            {previewImage && (
              <Image src={previewImage} alt="Preview" width={200} height={120} className="mt-2 rounded" />
            )}
          </div>

          {/* PDF Upload (‚≠ê Feature ƒë·∫∑c bi·ªát) */}
          <div>
            <Label>File PDF t√†i li·ªáu d·ª± √°n (optional)</Label>
            <Input 
              type="file" 
              accept="application/pdf" 
              onChange={handlePdfUpload} 
              disabled={isUploadingPdf} 
            />
            {isUploadingPdf && <p className="text-sm text-gray-500">ƒêang upload PDF...</p>}
            {pdfFile && (
              <div className="flex items-center gap-2 mt-2 text-sm text-green-600">
                <DocumentTextIcon className="w-5 h-5" />
                <span>ƒê√£ upload: {pdfFile.split('/').pop()}</span>
                <a href={pdfFile} target="_blank" className="text-blue-600 underline">
                  Xem
                </a>
              </div>
            )}
          </div>

          {/* Category Select */}
          <div>
            <Label>Danh m·ª•c</Label>
            <Select onValueChange={(value) => setValue('category_id', value)}>
              <SelectTrigger>
                <SelectValue placeholder="Ch·ªçn danh m·ª•c d·ª± √°n..." />
              </SelectTrigger>
              <SelectContent>
                {categories.map((cat) => (
                  <SelectItem key={cat.id} value={cat.id.toString()}>
                    {cat.name}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Status Select */}
          <div>
            <Label>Tr·∫°ng th√°i</Label>
            <Select onValueChange={(value) => setValue('status', value as 'draft' | 'published')}>
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="draft">Nh√°p</SelectItem>
                <SelectItem value="published">Xu·∫•t b·∫£n</SelectItem>
              </SelectContent>
            </Select>
          </div>

          {/* Submit Buttons */}
          <DialogFooter>
            <Button type="button" variant="outline" onClick={() => onOpenChange(false)}>
              H·ªßy
            </Button>
            <Button type="submit" disabled={isSubmitting}>
              {isSubmitting ? 'ƒêang l∆∞u...' : project ? 'C·∫≠p nh·∫≠t' : 'T·∫°o m·ªõi'}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  )
}
```

**Features ƒë·∫∑c bi·ªát**:
- ‚úÖ 2 upload handlers ri√™ng bi·ªát (Image + PDF)
- ‚úÖ Validate PDF file type v√† size
- ‚úÖ Preview PDF v·ªõi icon + link "Xem"
- ‚úÖ Upload PDF v√†o `/uploads/pdfs/`

---

## 5. Public UI Components

### 5.1. ProjectCard Component

**File**: `components/projects/ProjectCard.tsx`

```tsx
import Image from 'next/image'
import Link from 'next/link'
import { formatDate } from '@/lib/utils'
import { DocumentTextIcon } from '@heroicons/react/24/outline'
import type { Project, Category } from '@prisma/client'

type ProjectWithCategory = Project & {
  category: Pick<Category, 'id' | 'name'> | null
}

interface ProjectCardProps {
  project: ProjectWithCategory
}

export function ProjectCard({ project }: ProjectCardProps) {
  return (
    <div className="group bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
      {/* Cover Image */}
      {project.cover_image && (
        <Link href={`/du-an/${project.slug}`}>
          <div className="relative h-56 w-full">
            <Image
              src={project.cover_image}
              alt={project.title}
              fill
              className="object-cover group-hover:scale-105 transition-transform duration-300"
            />
          </div>
        </Link>
      )}

      <div className="p-5">
        {/* Category Badge */}
        {project.category && (
          <span className="text-xs text-blue-600 font-semibold uppercase">
            {project.category.name}
          </span>
        )}

        {/* Title */}
        <Link href={`/du-an/${project.slug}`}>
          <h3 className="text-xl font-bold text-gray-900 mt-2 group-hover:text-blue-600 transition-colors">
            {project.title}
          </h3>
        </Link>

        {/* Description */}
        {project.description && (
          <p className="text-gray-600 text-sm mt-3 line-clamp-3">
            {project.description}
          </p>
        )}

        {/* Footer */}
        <div className="flex items-center justify-between mt-4 pt-4 border-t">
          {/* PDF Download Button */}
          {project.pdf_file && (
            <a 
              href={project.pdf_file} 
              target="_blank" 
              rel="noopener noreferrer"
              className="flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 font-medium"
            >
              <DocumentTextIcon className="w-5 h-5" />
              T·∫£i t√†i li·ªáu
            </a>
          )}

          {/* Views */}
          <span className="text-xs text-gray-500">
            {project.views} l∆∞·ª£t xem
          </span>
        </div>
      </div>
    </div>
  )
}
```

**ƒêi·ªÉm kh√°c bi·ªát**:
- ‚úÖ Button "T·∫£i t√†i li·ªáu" n·∫øu c√≥ PDF
- ‚úÖ Card layout cao h∆°n (h-56 vs h-48)
- ‚úÖ Kh√¥ng hi·ªÉn th·ªã author

### 5.2. Projects List Page

**File**: `app/du-an/page.tsx`

```tsx
import { db } from '@/lib/db'
import { ProjectCard } from '@/components/projects/ProjectCard'

interface PageProps {
  searchParams: Promise<{ page?: string; category?: string }>
}

export default async function ProjectsPage({ searchParams }: PageProps) {
  const params = await searchParams
  const page = parseInt(params.page || '1')
  const categoryId = params.category ? parseInt(params.category) : undefined
  const limit = 12
  const offset = (page - 1) * limit

  const where = {
    status: 'published',
    ...(categoryId && { category_id: categoryId })
  }

  const [projects, total, categories] = await Promise.all([
    db.project.findMany({
      where,
      include: {
        category: {
          select: { id: true, name: true }
        }
      },
      orderBy: { published_at: 'desc' },
      skip: offset,
      take: limit
    }),
    db.project.count({ where }),
    db.category.findMany({
      where: {
        projects: {
          some: { status: 'published' }
        }
      },
      orderBy: { name: 'asc' }
    })
  ])

  const totalPages = Math.ceil(total / limit)

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="flex items-center justify-between mb-8">
        <h1 className="text-3xl font-bold">D·ª± √°n ti√™u bi·ªÉu</h1>

        {/* Category Filter */}
        <div className="flex gap-2">
          <Link href="/du-an">
            <Button variant={!categoryId ? 'default' : 'outline'} size="sm">
              T·∫•t c·∫£
            </Button>
          </Link>
          {categories.map((cat) => (
            <Link key={cat.id} href={`/du-an?category=${cat.id}`}>
              <Button 
                variant={categoryId === cat.id ? 'default' : 'outline'} 
                size="sm"
              >
                {cat.name}
              </Button>
            </Link>
          ))}
        </div>
      </div>

      {/* Grid Layout */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {projects.map((project) => (
          <ProjectCard key={project.id} project={project} />
        ))}
      </div>

      {/* Pagination */}
      {totalPages > 1 && (
        <div className="flex justify-center gap-2 mt-12">
          {Array.from({ length: totalPages }, (_, i) => i + 1).map((p) => (
            <Link key={p} href={`/du-an?page=${p}`}>
              <Button variant={p === page ? 'default' : 'outline'}>
                {p}
              </Button>
            </Link>
          ))}
        </div>
      )}
    </div>
  )
}
```

**Features**:
- ‚úÖ Category filter buttons
- ‚úÖ Grid layout 3 columns
- ‚úÖ Filter by category_id query param

### 5.3. Project Detail Page

**File**: `app/du-an/[slug]/page.tsx`

```tsx
import { notFound } from 'next/navigation'
import Image from 'next/image'
import { db } from '@/lib/db'
import { formatDate } from '@/lib/utils'
import { DocumentTextIcon } from '@heroicons/react/24/outline'

interface PageProps {
  params: Promise<{ slug: string }>
}

export default async function ProjectDetailPage({ params }: PageProps) {
  const { slug } = await params

  const project = await db.project.findUnique({
    where: { slug },
    include: {
      category: {
        select: { id: true, name: true }
      }
    }
  })

  if (!project || project.status !== 'published') {
    notFound()
  }

  // Increment views
  db.project.update({
    where: { id: project.id },
    data: { views: { increment: 1 } }
  }).catch(console.error)

  return (
    <article className="container mx-auto px-4 py-8 max-w-5xl">
      {/* Category */}
      {project.category && (
        <span className="text-sm text-blue-600 font-semibold uppercase">
          {project.category.name}
        </span>
      )}

      {/* Title */}
      <h1 className="text-4xl font-bold text-gray-900 mt-2">
        {project.title}
      </h1>

      {/* Meta */}
      <div className="flex items-center gap-4 text-sm text-gray-500 mt-4">
        <span>{formatDate(project.published_at || project.created_at)}</span>
        <span>‚Ä¢</span>
        <span>{project.views} l∆∞·ª£t xem</span>
      </div>

      {/* PDF Download Button (‚≠ê Prominent placement) */}
      {project.pdf_file && (
        <div className="mt-6">
          <a 
            href={project.pdf_file} 
            target="_blank" 
            rel="noopener noreferrer"
            className="inline-flex items-center gap-3 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            <DocumentTextIcon className="w-6 h-6" />
            <span className="font-semibold">T·∫£i t√†i li·ªáu d·ª± √°n (PDF)</span>
          </a>
        </div>
      )}

      {/* Cover Image */}
      {project.cover_image && (
        <div className="relative w-full h-[500px] mt-8">
          <Image
            src={project.cover_image}
            alt={project.title}
            fill
            className="object-cover rounded-lg"
            priority
          />
        </div>
      )}

      {/* Description */}
      {project.description && (
        <div className="mt-8 p-6 bg-gray-50 rounded-lg border-l-4 border-blue-600">
          <p className="text-lg text-gray-700 font-medium">
            {project.description}
          </p>
        </div>
      )}

      {/* Content */}
      {project.content && (
        <div 
          className="prose prose-lg max-w-none mt-8"
          dangerouslySetInnerHTML={{ __html: project.content }}
        />
      )}
    </article>
  )
}
```

**Features**:
- ‚úÖ Prominent PDF download button
- ‚úÖ Highlighted description box
- ‚úÖ Taller cover image (500px)
- ‚úÖ No author info

---

## 6. PDF File Upload

### 6.1. Upload API Enhancement

**File**: `app/api/upload/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server'
import { writeFile, mkdir } from 'fs/promises'
import path from 'path'

export async function POST(request: NextRequest) {
  try {
    const formData = await request.formData()
    const file = formData.get('file') as File
    const type = formData.get('type') as string // 'posts', 'projects', 'pdfs'

    if (!file) {
      return NextResponse.json(
        { success: false, message: 'No file uploaded' },
        { status: 400 }
      )
    }

    // Validate file type based on upload type
    if (type === 'pdfs') {
      // ‚≠ê PDF validation
      if (file.type !== 'application/pdf') {
        return NextResponse.json(
          { success: false, message: 'Only PDF files allowed' },
          { status: 400 }
        )
      }

      // Validate size (max 10MB for PDFs)
      if (file.size > 10 * 1024 * 1024) {
        return NextResponse.json(
          { success: false, message: 'PDF file size must be less than 10MB' },
          { status: 400 }
        )
      }
    } else {
      // Image validation
      if (!file.type.startsWith('image/')) {
        return NextResponse.json(
          { success: false, message: 'Only images allowed' },
          { status: 400 }
        )
      }

      // Validate size (max 5MB for images)
      if (file.size > 5 * 1024 * 1024) {
        return NextResponse.json(
          { success: false, message: 'Image size must be less than 5MB' },
          { status: 400 }
        )
      }
    }

    // Create unique filename
    const bytes = await file.arrayBuffer()
    const buffer = Buffer.from(bytes)
    const filename = `${Date.now()}-${file.name.replace(/\s/g, '-')}`
    const uploadDir = path.join(process.cwd(), 'public', 'uploads', type)
    const filepath = path.join(uploadDir, filename)

    // Ensure directory exists
    await mkdir(uploadDir, { recursive: true })

    // Save file
    await writeFile(filepath, buffer)

    const url = `/uploads/${type}/${filename}`

    return NextResponse.json({
      success: true,
      data: { 
        url, 
        filename,
        size: file.size,
        type: file.type
      }
    })
  } catch (error) {
    console.error('Upload error:', error)
    return NextResponse.json(
      { success: false, message: 'Upload failed' },
      { status: 500 }
    )
  }
}
```

**File Storage Structure**:
```
public/
  uploads/
    projects/          # Project images
      1702345678-khu-do-thi.jpg
      1702345679-can-ho.png
    pdfs/              # PDF documents
      1702345680-brochure.pdf
      1702345681-tech-specs.pdf
    posts/             # Post images
      ...
```

### 6.2. PDF Validation Rules

| Rule | Value | Reason |
|------|-------|--------|
| **File Type** | `application/pdf` only | Security |
| **Max Size** | 10 MB | Performance |
| **Storage** | `/uploads/pdfs/` | Organization |
| **Naming** | `timestamp-filename.pdf` | Unique |

---

## 7. Differences vs Posts

### 7.1. Feature Comparison Table

| Feature | Posts | Projects |
|---------|-------|----------|
| **Author** | ‚úÖ User relationship | ‚ùå No author |
| **PDF File** | ‚ùå Not supported | ‚úÖ Supported |
| **Status Options** | draft/published/archived | draft/published |
| **Content Field** | Text (65,535 chars) | LongText (4GB) |
| **Primary Use** | News, articles | Portfolio, showcases |
| **Upload Types** | Images only | Images + PDFs |
| **Public URL** | `/tin-tuc/[slug]` | `/du-an/[slug]` |

### 7.2. Code Differences

**Database Schema**:
```prisma
// Posts
model Post {
  author_id Int
  author    User @relation(...)  // ‚úÖ Has author
  status    String               // draft/published/archived
  content   String @db.Text      // Shorter
}

// Projects
model Project {
  // ‚ùå No author_id, no author relation
  status    ProjectStatus        // draft/published only
  content   String? @db.LongText // Longer
  pdf_file  String?              // ‚≠ê Extra field
}
```

**Form Fields**:
```tsx
// PostFormDialog
<Input {...register('title')} />
<Textarea {...register('content')} rows={10} />
<Input type="file" accept="image/*" />  // Image only

// ProjectFormDialog
<Input {...register('title')} />
<Textarea {...register('description')} rows={3} />
<Textarea {...register('content')} rows={8} />
<Input type="file" accept="image/*" />      // Image
<Input type="file" accept="application/pdf" />  // ‚≠ê PDF
```

### 7.3. When to Use Which?

**Use Posts for**:
- üì∞ News articles
- üìù Blog posts
- üì¢ Announcements
- üìñ Tutorials
- Content with specific authors

**Use Projects for**:
- üèóÔ∏è Construction projects
- üè¢ Real estate developments
- üé® Portfolio items
- üìä Case studies
- Content with downloadable brochures

---

## 8. Complete Workflow

### 8.1. Create Project Flow

```
1. Admin clicks "T·∫°o d·ª± √°n m·ªõi"
   ‚îî‚îÄ> ProjectsTable
   ‚îî‚îÄ> setIsCreateOpen(true)

2. Dialog opens
   ‚îî‚îÄ> ProjectFormDialog
   ‚îî‚îÄ> Form with empty values

3. Admin fills form
   ‚îú‚îÄ> Title, description, content
   ‚îú‚îÄ> Upload cover image
   ‚îÇ   ‚îî‚îÄ> POST /api/upload (type: 'projects')
   ‚îÇ   ‚îî‚îÄ> Image saved to /uploads/projects/
   ‚îÇ   ‚îî‚îÄ> setValue('cover_image', url)
   ‚îî‚îÄ> Upload PDF (optional)
       ‚îî‚îÄ> POST /api/upload (type: 'pdfs')
       ‚îî‚îÄ> Validate PDF type + size
       ‚îî‚îÄ> PDF saved to /uploads/pdfs/
       ‚îî‚îÄ> setValue('pdf_file', url)

4. Admin selects category

5. Admin submits
   ‚îî‚îÄ> POST /api/projects
   ‚îî‚îÄ> Server:
       ‚îú‚îÄ> Validate with projectSchema
       ‚îú‚îÄ> Generate slug from title
       ‚îú‚îÄ> Create project in database
       ‚îî‚îÄ> Return success

6. Success
   ‚îî‚îÄ> Toast notification
   ‚îî‚îÄ> Reload page
   ‚îî‚îÄ> See new project in table
```

### 8.2. Public View Flow

```
1. User visits /du-an
   ‚îî‚îÄ> Server Component
   ‚îî‚îÄ> Fetch projects (status = 'published')
   ‚îî‚îÄ> Optional category filter
   ‚îî‚îÄ> Render grid with ProjectCard

2. User clicks project card
   ‚îî‚îÄ> Navigate to /du-an/[slug]
   ‚îî‚îÄ> Server Component:
       ‚îú‚îÄ> findUnique({ where: { slug } })
       ‚îú‚îÄ> Check published status
       ‚îú‚îÄ> Increment views
       ‚îî‚îÄ> Render detail page

3. Page displays
   ‚îú‚îÄ> Cover image (large)
   ‚îú‚îÄ> Description (highlighted box)
   ‚îú‚îÄ> PDF download button (‚≠ê if available)
   ‚îî‚îÄ> Full content (LongText)

4. User clicks "T·∫£i t√†i li·ªáu"
   ‚îî‚îÄ> Opens PDF in new tab
   ‚îî‚îÄ> Direct file download
```

### 8.3. PDF Download Flow

```
1. User clicks "T·∫£i t√†i li·ªáu d·ª± √°n"
   ‚îî‚îÄ> Link href={project.pdf_file}
   ‚îî‚îÄ> target="_blank"
   ‚îî‚îÄ> rel="noopener noreferrer"

2. Browser opens new tab
   ‚îî‚îÄ> URL: /uploads/pdfs/1702345680-brochure.pdf
   ‚îî‚îÄ> PDF viewer opens (in-browser)

3. User can:
   ‚îú‚îÄ> View PDF in browser
   ‚îú‚îÄ> Download to device
   ‚îî‚îÄ> Print
```

---

## üéØ T·ªïng K·∫øt

### ‚úÖ ƒê√£ h·ªçc ƒë∆∞·ª£c:

1. **Project Model**: Schema v·ªõi pdf_file field
2. **API Routes**: CRUD operations cho projects
3. **PDF Upload**: Validation, storage, v√† display
4. **Two Upload Handlers**: Image + PDF ri√™ng bi·ªát
5. **Public UI**: ProjectCard v·ªõi PDF button
6. **Differences**: So s√°nh Posts vs Projects
7. **Category Filter**: Public list page filtering
8. **File Storage**: Organization /uploads/projects/ v√† /uploads/pdfs/

### üìù Key Takeaways:

- ‚úÖ Projects kh√¥ng c√≥ author (kh√°c Posts)
- ‚úÖ PDF upload c·∫ßn validate type + size
- ‚úÖ LongText cho content d√†i h∆°n
- ‚úÖ Prominent PDF download button trong detail page
- ‚úÖ Category filter trong public list
- ‚úÖ Status ch·ªâ c√≥ draft/published

### üöÄ Next Steps:

- ƒê·ªçc **08.3_FEATURES_VIDEOS.md** ƒë·ªÉ h·ªçc Videos management
- Implement PDF preview (kh√¥ng ch·ªâ download)
- Add image gallery cho projects
- Implement project search
- Add related projects

---

**Ch√∫c m·ª´ng!** üéâ B·∫°n ƒë√£ hi·ªÉu 100% Projects Management system!

*Last updated: November 28, 2025*
