# 08.3. FEATURES - VIDEOS MANAGEMENT

> ‚è±Ô∏è **Th·ªùi gian ƒë·ªçc**: 40-60 ph√∫t  
> üéØ **M·ª•c ti√™u**: Hi·ªÉu 100% t√≠nh nƒÉng qu·∫£n l√Ω videos (Videos Management)

---

## üìò M·ª§C L·ª§C

1. [T·ªïng quan Videos Management](#1-t·ªïng-quan-videos-management)
2. [Database Schema](#2-database-schema)
3. [API Routes](#3-api-routes)
4. [Admin UI Components](#4-admin-ui-components)
5. [Public UI Components](#5-public-ui-components)
6. [YouTube Integration](#6-youtube-integration)
7. [Display Ordering](#7-display-ordering)
8. [Complete Workflow](#8-complete-workflow)

---

## 1. T·ªïng quan Videos Management

### 1.1. Ch·ª©c nƒÉng ch√≠nh

**Videos Management** qu·∫£n l√Ω video t·ª´ YouTube v·ªõi c√°c t√≠nh nƒÉng:

```
‚úÖ Create   - Th√™m video m·ªõi (YouTube URL)
‚úÖ Read     - Xem danh s√°ch video
‚úÖ Update   - Ch·ªânh s·ª≠a th√¥ng tin video
‚úÖ Delete   - X√≥a video
‚úÖ Embed    - YouTube iframe embed
‚úÖ Ordering - S·∫Øp x·∫øp th·ª© t·ª± hi·ªÉn th·ªã
‚úÖ Status   - Qu·∫£n l√Ω tr·∫°ng th√°i (active/inactive)
‚úÖ Thumbnail- T·ª± ƒë·ªông l·∫•y t·ª´ YouTube ho·∫∑c upload custom
```

### 1.2. ƒê·∫∑c ƒëi·ªÉm ri√™ng

| Feature | Posts/Projects | Videos |
|---------|----------------|--------|
| **Content Source** | N·ªôi dung t·ª± vi·∫øt | YouTube URLs |
| **File Upload** | Images, PDFs | ‚ùå Ch·ªâ link YouTube |
| **Thumbnail** | Upload manually | YouTube auto ho·∫∑c custom |
| **Ordering** | Theo date | `display_order` field |
| **Slug** | ‚úÖ C√≥ | ‚ùå Kh√¥ng c·∫ßn |
| **Views Tracking** | ‚úÖ C√≥ | ‚ùå Kh√¥ng |

### 1.3. C·∫•u tr√∫c Files

```
app/
  admin/videos/
    page.tsx                          # Trang qu·∫£n l√Ω videos (Admin)
  videos/
    page.tsx                          # Danh s√°ch videos (Public)
  api/videos/
    route.ts                          # GET (list), POST (create)
    [id]/
      route.ts                        # GET, PUT, DELETE

components/
  admin/
    VideosTable.tsx                   # Table qu·∫£n l√Ω videos
    VideoFormDialog.tsx               # Form t·∫°o/s·ª≠a video
  videos/
    VideoGrid.tsx                     # Grid hi·ªÉn th·ªã videos
    VideoPlayer.tsx                   # YouTube player embed

lib/
  validations.ts                      # Zod schema cho Video
  utils.ts                            # YouTube URL helper functions
```

---

## 2. Database Schema

### 2.1. Video Model

```prisma
// prisma/schema.prisma
model Video {
  id            Int         @id @default(autoincrement())
  title         String      @db.VarChar(255)
  description   String?     @db.Text
  video_url     String      @db.VarChar(500)      // ‚≠ê YouTube URL
  thumbnail_url String?     @db.VarChar(500)      // Custom ho·∫∑c YouTube auto
  duration      String?     @db.VarChar(20)       // VD: "10:45"
  display_order Int         @default(0)           // ‚≠ê Th·ª© t·ª± hi·ªÉn th·ªã
  status        VideoStatus @default(active)      // active, inactive
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt

  @@index([status])
  @@index([display_order])
  @@map("videos")
}

enum VideoStatus {
  active
  inactive
}
```

### 2.2. No Relationships

**Videos ho√†n to√†n ƒë·ªôc l·∫≠p**:
- ‚ùå Kh√¥ng c√≥ `category_id`
- ‚ùå Kh√¥ng c√≥ `author_id`
- ‚ùå Kh√¥ng c√≥ `slug`
- ‚úÖ Ch·ªâ c·∫ßn URL YouTube

### 2.3. Key Fields

| Field | Type | M√¥ t·∫£ |
|-------|------|-------|
| `video_url` | String | YouTube URL (https://youtube.com/watch?v=...) |
| `thumbnail_url` | String? | URL thumbnail (YouTube auto ho·∫∑c custom) |
| `duration` | String? | Th·ªùi l∆∞·ª£ng video (VD: "10:45", "1:23:45") |
| `display_order` | Int | Th·ª© t·ª± hi·ªÉn th·ªã (nh·ªè h∆°n = hi·ªÉn th·ªã tr∆∞·ªõc) |
| `status` | Enum | `active` (hi·ªÉn th·ªã) ho·∫∑c `inactive` (·∫©n) |

---

## 3. API Routes

### 3.1. GET /api/videos - List Videos

**File**: `app/api/videos/route.ts`

```typescript
export async function GET() {
  try {
    const videos = await db.video.findMany({
      orderBy: [
        { display_order: 'asc' },   // ‚≠ê S·∫Øp x·∫øp theo order tr∆∞·ªõc
        { created_at: 'desc' }      // R·ªìi m·ªõi theo date
      ]
    })

    return NextResponse.json({
      success: true,
      data: videos
    })
  } catch (error) {
    console.error('Get videos error:', error)
    return NextResponse.json(
      { success: false, message: 'L·ªói server' },
      { status: 500 }
    )
  }
}
```

**ƒê·∫∑c ƒëi·ªÉm**:
- ‚úÖ Kh√¥ng c√≥ pagination (th∆∞·ªùng √≠t videos)
- ‚úÖ Sort theo `display_order` tr∆∞·ªõc
- ‚úÖ Kh√¥ng filter theo status (admin xem t·∫•t c·∫£)

**Response Format**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "Gi·ªõi thi·ªáu d·ª± √°n",
      "description": "Video gi·ªõi thi·ªáu t·ªïng quan d·ª± √°n...",
      "video_url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
      "thumbnail_url": "https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
      "duration": "5:30",
      "display_order": 1,
      "status": "active",
      "created_at": "2024-01-15T10:30:00.000Z"
    }
  ]
}
```

### 3.2. POST /api/videos - Create Video

**Authentication**: Required

```typescript
export async function POST(request: NextRequest) {
  try {
    const session = await auth()
    
    if (!session?.user) {
      return NextResponse.json(
        { success: false, message: 'Unauthorized' },
        { status: 401 }
      )
    }

    const body = await request.json()
    const validatedData = videoSchema.parse(body)

    const video = await db.video.create({
      data: {
        title: validatedData.title,
        description: validatedData.description || null,
        video_url: validatedData.video_url,
        thumbnail_url: validatedData.thumbnail_url || null,
        duration: validatedData.duration || null,
        display_order: validatedData.display_order,
        status: validatedData.status,
      }
    })

    return NextResponse.json({
      success: true,
      data: video,
      message: 'ƒê√£ t·∫°o video m·ªõi'
    }, { status: 201 })
  } catch (error) {
    console.error('Create video error:', error)
    return NextResponse.json(
      { success: false, message: 'L·ªói server' },
      { status: 500 }
    )
  }
}
```

**Request Body**:
```json
{
  "title": "Gi·ªõi thi·ªáu d·ª± √°n",
  "description": "Video t·ªïng quan v·ªÅ d·ª± √°n",
  "video_url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  "thumbnail_url": "",
  "duration": "5:30",
  "display_order": 1,
  "status": "active"
}
```

**Validation** (Zod):
- `title`: Required, max 255 chars
- `video_url`: Required, must be valid URL
- `thumbnail_url`: Optional
- `display_order`: Integer, default 0
- `status`: Enum ("active", "inactive")

### 3.3. PUT /api/videos/[id] - Update Video

```typescript
export async function PUT(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await auth()
    if (!session?.user) {
      return NextResponse.json(
        { success: false, message: 'Unauthorized' },
        { status: 401 }
      )
    }

    const { id } = await params
    const body = await request.json()
    const validatedData = videoSchema.parse(body)

    const video = await db.video.update({
      where: { id: parseInt(id) },
      data: {
        title: validatedData.title,
        description: validatedData.description || null,
        video_url: validatedData.video_url,
        thumbnail_url: validatedData.thumbnail_url || null,
        duration: validatedData.duration || null,
        display_order: validatedData.display_order,
        status: validatedData.status,
      }
    })

    return NextResponse.json({
      success: true,
      data: video,
      message: 'ƒê√£ c·∫≠p nh·∫≠t video'
    })
  } catch (error) {
    console.error('Update video error:', error)
    return NextResponse.json(
      { success: false, message: 'L·ªói server' },
      { status: 500 }
    )
  }
}
```

### 3.4. DELETE /api/videos/[id]

```typescript
export async function DELETE(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const session = await auth()
    if (!session?.user) {
      return NextResponse.json(
        { success: false, message: 'Unauthorized' },
        { status: 401 }
      )
    }

    const { id } = await params

    await db.video.delete({
      where: { id: parseInt(id) }
    })

    return NextResponse.json({
      success: true,
      message: 'ƒê√£ x√≥a video'
    })
  } catch (error) {
    console.error('Delete video error:', error)
    return NextResponse.json(
      { success: false, message: 'L·ªói server' },
      { status: 500 }
    )
  }
}
```

---

## 4. Admin UI Components

### 4.1. VideosTable Component

**File**: `components/admin/VideosTable.tsx`

**Ch·ª©c nƒÉng**:
- Hi·ªÉn th·ªã danh s√°ch videos
- Preview thumbnail
- Link xem video tr√™n YouTube
- Edit, Delete actions
- Drag & Drop ordering (optional advanced feature)

**Code Structure**:

```tsx
'use client'

import { useState } from 'react'
import Image from 'next/image'
import { Button } from '@/components/ui/button'
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'
import { Badge } from '@/components/ui/badge'
import { EyeSlashIcon, ArrowTopRightOnSquareIcon, PlusIcon } from '@heroicons/react/24/outline'
import { VideoFormDialog } from './VideoFormDialog'

interface VideosTableProps {
  videos: Video[]
}

export function VideosTable({ videos }: VideosTableProps) {
  const [isCreateOpen, setIsCreateOpen] = useState(false)
  const [editingVideo, setEditingVideo] = useState<Video | null>(null)

  return (
    <div className="space-y-4">
      {/* Create Button */}
      <div className="flex justify-end">
        <Button onClick={() => setIsCreateOpen(true)}>
          <PlusIcon className="w-4 h-4 mr-2" />
          T·∫°o Video m·ªõi
        </Button>
      </div>

      {/* Table */}
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead className="w-20">Thumbnail</TableHead>
            <TableHead>Ti√™u ƒë·ªÅ</TableHead>
            <TableHead>Th·ªùi l∆∞·ª£ng</TableHead>
            <TableHead>Th·ª© t·ª±</TableHead>
            <TableHead>Tr·∫°ng th√°i</TableHead>
            <TableHead className="text-right">H√†nh ƒë·ªông</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {videos.map((video) => (
            <TableRow key={video.id}>
              {/* Thumbnail Column */}
              <TableCell>
                {video.thumbnail_url ? (
                  <div className="relative w-16 h-16">
                    <Image
                      src={video.thumbnail_url}
                      alt={video.title}
                      fill
                      className="object-cover rounded"
                    />
                  </div>
                ) : (
                  <div className="w-16 h-16 bg-gray-200 rounded flex items-center justify-center">
                    <EyeSlashIcon className="w-6 h-6 text-gray-400" />
                  </div>
                )}
              </TableCell>

              {/* Title + Link Column */}
              <TableCell>
                <div className="space-y-1">
                  <p className="font-medium">{video.title}</p>
                  <a
                    href={video.video_url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-sm text-blue-600 hover:underline flex items-center gap-1"
                  >
                    Xem video
                    <ArrowTopRightOnSquareIcon className="w-3 h-3" />
                  </a>
                </div>
              </TableCell>

              {/* Duration */}
              <TableCell>{video.duration || '‚Äî'}</TableCell>

              {/* Display Order */}
              <TableCell>
                <Badge variant="outline">{video.display_order}</Badge>
              </TableCell>

              {/* Status */}
              <TableCell>
                <Badge variant={video.status === 'active' ? 'default' : 'secondary'}>
                  {video.status === 'active' ? 'Hi·ªÉn th·ªã' : '·∫®n'}
                </Badge>
              </TableCell>

              {/* Actions */}
              <TableCell>
                <DropdownMenu>
                  <DropdownMenuItem onClick={() => setEditingVideo(video)}>
                    Ch·ªânh s·ª≠a
                  </DropdownMenuItem>
                  <DropdownMenuItem onClick={() => setDeletingVideo(video)}>
                    X√≥a
                  </DropdownMenuItem>
                </DropdownMenu>
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>

      {/* Dialogs */}
      <VideoFormDialog
        open={isCreateOpen}
        onOpenChange={setIsCreateOpen}
        onSuccess={() => window.location.reload()}
      />
    </div>
  )
}
```

**ƒêi·ªÉm ƒë·∫∑c bi·ªát**:
- ‚úÖ Thumbnail preview (16x16 ratio)
- ‚úÖ Link external ƒë·∫øn YouTube
- ‚úÖ Display order badge
- ‚úÖ No pagination (danh s√°ch ng·∫Øn)

### 4.2. VideoFormDialog Component

**File**: `components/admin/VideoFormDialog.tsx`

**Ch·ª©c nƒÉng**:
- Form t·∫°o/s·ª≠a video
- Input YouTube URL
- Auto-extract video ID
- Auto-generate thumbnail URL t·ª´ YouTube
- Manual input duration
- Display order input

**Code Structure**:

```tsx
'use client'

import { useState, useEffect } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { Dialog, DialogContent } from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import { Select } from '@/components/ui/select'

const videoFormSchema = z.object({
  title: z.string().min(1, 'Ti√™u ƒë·ªÅ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng').max(255),
  description: z.string().optional(),
  video_url: z.string().url('URL video kh√¥ng h·ª£p l·ªá').max(500),
  thumbnail_url: z.string().optional(),
  duration: z.string().max(20).optional(),
  display_order: z.number().int().default(0),
  status: z.enum(['active', 'inactive']),
})

type VideoFormData = z.infer<typeof videoFormSchema>

export function VideoFormDialog({ open, onOpenChange, video, onSuccess }) {
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [videoPreview, setVideoPreview] = useState<string | null>(null)

  const { register, handleSubmit, formState: { errors }, setValue, watch } = useForm<VideoFormData>({
    resolver: zodResolver(videoFormSchema),
  })

  const videoUrl = watch('video_url')

  // Auto-extract YouTube ID and generate thumbnail
  useEffect(() => {
    if (videoUrl) {
      const videoId = extractYouTubeId(videoUrl)
      if (videoId) {
        // Auto-fill thumbnail n·∫øu ch∆∞a c√≥
        const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`
        setValue('thumbnail_url', thumbnailUrl)
        setVideoPreview(videoId)
      }
    }
  }, [videoUrl, setValue])

  const onSubmit = async (data: VideoFormData) => {
    setIsSubmitting(true)
    try {
      const url = video ? `/api/videos/${video.id}` : '/api/videos'
      const method = video ? 'PUT' : 'POST'

      await fetch(url, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      })

      onSuccess()
      onOpenChange(false)
    } finally {
      setIsSubmitting(false)
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-3xl">
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          {/* Title */}
          <div>
            <Label>Ti√™u ƒë·ªÅ video</Label>
            <Input {...register('title')} placeholder="VD: Gi·ªõi thi·ªáu d·ª± √°n..." />
            {errors.title && <p className="text-sm text-red-500">{errors.title.message}</p>}
          </div>

          {/* Description */}
          <div>
            <Label>M√¥ t·∫£ (optional)</Label>
            <Textarea {...register('description')} rows={3} />
          </div>

          {/* YouTube URL (‚≠ê Main field) */}
          <div>
            <Label>YouTube URL</Label>
            <Input 
              {...register('video_url')} 
              placeholder="https://www.youtube.com/watch?v=..." 
            />
            {errors.video_url && <p className="text-sm text-red-500">{errors.video_url.message}</p>}
            <p className="text-xs text-gray-500 mt-1">
              Paste link YouTube (https://youtube.com/watch?v=... ho·∫∑c https://youtu.be/...)
            </p>
          </div>

          {/* Video Preview */}
          {videoPreview && (
            <div>
              <Label>Preview</Label>
              <div className="aspect-video bg-black rounded-lg overflow-hidden">
                <iframe
                  src={`https://www.youtube.com/embed/${videoPreview}`}
                  className="w-full h-full"
                  allowFullScreen
                />
              </div>
            </div>
          )}

          {/* Thumbnail URL (Auto-filled) */}
          <div>
            <Label>Thumbnail URL (t·ª± ƒë·ªông t·ª´ YouTube)</Label>
            <Input {...register('thumbnail_url')} placeholder="T·ª± ƒë·ªông ƒëi·ªÅn..." readOnly />
          </div>

          {/* Duration */}
          <div>
            <Label>Th·ªùi l∆∞·ª£ng (optional)</Label>
            <Input {...register('duration')} placeholder="VD: 5:30, 1:23:45" />
            <p className="text-xs text-gray-500 mt-1">
              Format: mm:ss ho·∫∑c hh:mm:ss
            </p>
          </div>

          {/* Display Order */}
          <div>
            <Label>Th·ª© t·ª± hi·ªÉn th·ªã</Label>
            <Input 
              type="number" 
              {...register('display_order', { valueAsNumber: true })} 
              placeholder="0" 
            />
            <p className="text-xs text-gray-500 mt-1">
              S·ªë nh·ªè h∆°n s·∫Ω hi·ªÉn th·ªã tr∆∞·ªõc (0, 1, 2...)
            </p>
          </div>

          {/* Status */}
          <div>
            <Label>Tr·∫°ng th√°i</Label>
            <Select onValueChange={(value) => setValue('status', value as 'active' | 'inactive')}>
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="active">Hi·ªÉn th·ªã</SelectItem>
                <SelectItem value="inactive">·∫®n</SelectItem>
              </SelectContent>
            </Select>
          </div>

          {/* Submit */}
          <DialogFooter>
            <Button type="button" variant="outline" onClick={() => onOpenChange(false)}>
              H·ªßy
            </Button>
            <Button type="submit" disabled={isSubmitting}>
              {isSubmitting ? 'ƒêang l∆∞u...' : video ? 'C·∫≠p nh·∫≠t' : 'T·∫°o m·ªõi'}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  )
}

// ‚≠ê Helper function - Extract YouTube Video ID
function extractYouTubeId(url: string): string | null {
  const patterns = [
    /youtube\.com\/watch\?v=([^&]+)/,        // https://youtube.com/watch?v=VIDEO_ID
    /youtu\.be\/([^?]+)/,                    // https://youtu.be/VIDEO_ID
    /youtube\.com\/embed\/([^?]+)/,          // https://youtube.com/embed/VIDEO_ID
  ]

  for (const pattern of patterns) {
    const match = url.match(pattern)
    if (match && match[1]) {
      return match[1]
    }
  }

  return null
}
```

**Features ƒë·∫∑c bi·ªát**:
- ‚úÖ Auto-extract YouTube video ID
- ‚úÖ Auto-generate thumbnail URL
- ‚úÖ Live preview iframe
- ‚úÖ Display order input
- ‚úÖ Duration format hints

---

## 5. Public UI Components

### 5.1. VideoGrid Component

**File**: `components/videos/VideoGrid.tsx`

```tsx
import { VideoCard } from './VideoCard'
import type { Video } from '@prisma/client'

interface VideoGridProps {
  videos: Video[]
}

export function VideoGrid({ videos }: VideoGridProps) {
  // Ch·ªâ hi·ªÉn th·ªã videos c√≥ status = 'active'
  const activeVideos = videos.filter(v => v.status === 'active')

  if (activeVideos.length === 0) {
    return (
      <div className="text-center py-12">
        <p className="text-gray-500">Ch∆∞a c√≥ video n√†o</p>
      </div>
    )
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {activeVideos.map((video) => (
        <VideoCard key={video.id} video={video} />
      ))}
    </div>
  )
}
```

### 5.2. VideoCard Component

**File**: `components/videos/VideoCard.tsx`

```tsx
import Image from 'next/image'
import { useState } from 'react'
import { VideoPlayer } from './VideoPlayer'

interface VideoCardProps {
  video: Video
}

export function VideoCard({ video }: VideoCardProps) {
  const [isPlaying, setIsPlaying] = useState(false)

  return (
    <div className="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
      {/* Thumbnail / Player */}
      <div className="relative aspect-video bg-black">
        {!isPlaying ? (
          <button
            onClick={() => setIsPlaying(true)}
            className="w-full h-full relative group"
          >
            {video.thumbnail_url && (
              <Image
                src={video.thumbnail_url}
                alt={video.title}
                fill
                className="object-cover"
              />
            )}
            {/* Play Button Overlay */}
            <div className="absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/50 transition-colors">
              <div className="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg className="w-8 h-8 text-white ml-1" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" />
                </svg>
              </div>
            </div>
            {/* Duration Badge */}
            {video.duration && (
              <div className="absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded">
                {video.duration}
              </div>
            )}
          </button>
        ) : (
          <VideoPlayer videoUrl={video.video_url} />
        )}
      </div>

      {/* Info */}
      <div className="p-4">
        <h3 className="font-semibold text-lg text-gray-900 mb-2">
          {video.title}
        </h3>
        {video.description && (
          <p className="text-sm text-gray-600 line-clamp-2">
            {video.description}
          </p>
        )}
      </div>
    </div>
  )
}
```

### 5.3. VideoPlayer Component

**File**: `components/videos/VideoPlayer.tsx`

```tsx
interface VideoPlayerProps {
  videoUrl: string
}

export function VideoPlayer({ videoUrl }: VideoPlayerProps) {
  const videoId = extractYouTubeId(videoUrl)

  if (!videoId) {
    return (
      <div className="w-full h-full flex items-center justify-center bg-gray-900 text-white">
        Invalid video URL
      </div>
    )
  }

  return (
    <iframe
      src={`https://www.youtube.com/embed/${videoId}?autoplay=1`}
      className="w-full h-full"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowFullScreen
    />
  )
}

function extractYouTubeId(url: string): string | null {
  const patterns = [
    /youtube\.com\/watch\?v=([^&]+)/,
    /youtu\.be\/([^?]+)/,
    /youtube\.com\/embed\/([^?]+)/,
  ]

  for (const pattern of patterns) {
    const match = url.match(pattern)
    if (match && match[1]) return match[1]
  }

  return null
}
```

### 5.4. Videos Public Page

**File**: `app/videos/page.tsx`

```tsx
import { db } from '@/lib/db'
import { VideoGrid } from '@/components/videos/VideoGrid'

export default async function VideosPage() {
  const videos = await db.video.findMany({
    where: { status: 'active' },  // Ch·ªâ videos active
    orderBy: [
      { display_order: 'asc' },
      { created_at: 'desc' }
    ]
  })

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900">Videos</h1>
        <p className="text-gray-600 mt-2">
          Kh√°m ph√° c√°c video v·ªÅ d·ª± √°n v√† ho·∫°t ƒë·ªông c·ªßa ch√∫ng t√¥i
        </p>
      </div>

      <VideoGrid videos={videos} />
    </div>
  )
}
```

---

## 6. YouTube Integration

### 6.1. YouTube URL Formats

**Supported Formats**:

```
1. Standard URL:
   https://www.youtube.com/watch?v=dQw4w9WgXcQ

2. Short URL:
   https://youtu.be/dQw4w9WgXcQ

3. Embed URL:
   https://www.youtube.com/embed/dQw4w9WgXcQ

4. With timestamp:
   https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=120s
```

### 6.2. Extract Video ID Helper

**File**: `lib/utils.ts`

```typescript
export function extractYouTubeId(url: string): string | null {
  if (!url) return null

  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&?]+)/,
  ]

  for (const pattern of patterns) {
    const match = url.match(pattern)
    if (match && match[1]) {
      return match[1]
    }
  }

  return null
}
```

**Usage**:
```typescript
const videoId = extractYouTubeId("https://youtube.com/watch?v=dQw4w9WgXcQ")
// Returns: "dQw4w9WgXcQ"
```

### 6.3. YouTube Thumbnail URLs

**Available Sizes**:

```typescript
const videoId = "dQw4w9WgXcQ"

// Default (120x90)
const thumb1 = `https://img.youtube.com/vi/${videoId}/default.jpg`

// Medium (320x180)
const thumb2 = `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`

// High (480x360)
const thumb3 = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`

// Max Resolution (1280x720)
const thumb4 = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`
```

**Recommended**: Use `maxresdefault.jpg` cho ch·∫•t l∆∞·ª£ng t·ªët nh·∫•t.

### 6.4. YouTube Embed Parameters

```typescript
const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1`
```

**Parameters**:
- `autoplay=1`: T·ª± ƒë·ªông play khi load
- `rel=0`: Kh√¥ng hi·ªÉn th·ªã related videos
- `modestbranding=1`: ·∫®n YouTube logo
- `controls=1`: Hi·ªÉn th·ªã controls (default)
- `start=120`: B·∫Øt ƒë·∫ßu t·ª´ gi√¢y th·ª© 120

---

## 7. Display Ordering

### 7.1. Ordering Logic

**Database Query**:
```typescript
const videos = await db.video.findMany({
  orderBy: [
    { display_order: 'asc' },   // Th·ª© t·ª± ∆∞u ti√™n
    { created_at: 'desc' }      // M·ªõi nh·∫•t n·∫øu c√πng order
  ]
})
```

**Example**:
```
Video A: display_order = 1  ‚Üí Hi·ªÉn th·ªã ƒë·∫ßu ti√™n
Video B: display_order = 2  ‚Üí Hi·ªÉn th·ªã th·ª© 2
Video C: display_order = 2  ‚Üí C√πng order ‚Üí Sort by created_at
Video D: display_order = 5  ‚Üí Hi·ªÉn th·ªã cu·ªëi
```

### 7.2. Change Order in Admin

**Simple Approach** - Input number:
```tsx
<Input 
  type="number" 
  {...register('display_order', { valueAsNumber: true })} 
  placeholder="0" 
/>
```

**Advanced Approach** - Drag & Drop (Optional):

```tsx
import { DndContext, closestCenter } from '@dnd-kit/core'
import { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable'

export function VideosTable({ videos }: VideosTableProps) {
  const [items, setItems] = useState(videos)

  const handleDragEnd = async (event: any) => {
    const { active, over } = event
    if (active.id !== over.id) {
      // Reorder logic
      const oldIndex = items.findIndex(item => item.id === active.id)
      const newIndex = items.findIndex(item => item.id === over.id)
      
      // Update display_order in database
      await updateVideoOrder(active.id, newIndex)
    }
  }

  return (
    <DndContext collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
      <SortableContext items={items} strategy={verticalListSortingStrategy}>
        {/* Table rows with drag handle */}
      </SortableContext>
    </DndContext>
  )
}
```

---

## 8. Complete Workflow

### 8.1. Create Video Flow

```
1. Admin clicks "T·∫°o Video m·ªõi"
   ‚îî‚îÄ> VideosTable
   ‚îî‚îÄ> setIsCreateOpen(true)

2. Dialog opens
   ‚îî‚îÄ> VideoFormDialog
   ‚îî‚îÄ> Empty form

3. Admin paste YouTube URL
   ‚îî‚îÄ> Input onChange
   ‚îî‚îÄ> extractYouTubeId(url)
   ‚îî‚îÄ> Auto-fill thumbnail_url
   ‚îî‚îÄ> Show preview iframe

4. Admin fills remaining fields
   ‚îú‚îÄ> Title, description
   ‚îú‚îÄ> Duration (manual)
   ‚îú‚îÄ> Display order (default 0)
   ‚îî‚îÄ> Status (active/inactive)

5. Submit
   ‚îî‚îÄ> POST /api/videos
   ‚îî‚îÄ> Validate with videoSchema
   ‚îî‚îÄ> Create video in database
   ‚îî‚îÄ> Success toast
   ‚îî‚îÄ> Reload page

6. Video appears in table
   ‚îî‚îÄ> Sorted by display_order
```

### 8.2. Public View Flow

```
1. User visits /videos
   ‚îî‚îÄ> Server Component
   ‚îî‚îÄ> Fetch videos (status = 'active')
   ‚îî‚îÄ> Sort by display_order ‚Üí created_at
   ‚îî‚îÄ> Render VideoGrid

2. Page displays
   ‚îî‚îÄ> Grid of VideoCards
   ‚îî‚îÄ> Each card shows:
       ‚îú‚îÄ> Thumbnail
       ‚îú‚îÄ> Play button overlay
       ‚îî‚îÄ> Duration badge

3. User clicks Play button
   ‚îî‚îÄ> setIsPlaying(true)
   ‚îî‚îÄ> Replace thumbnail with VideoPlayer
   ‚îî‚îÄ> YouTube iframe loads
   ‚îî‚îÄ> Video autoplays

4. Video plays
   ‚îî‚îÄ> YouTube embedded player
   ‚îî‚îÄ> Full controls available
   ‚îî‚îÄ> Responsive aspect ratio
```

### 8.3. Edit Order Flow

```
1. Admin wants to reorder videos
   ‚îî‚îÄ> Open edit dialog for video
   ‚îî‚îÄ> Change display_order value
   ‚îî‚îÄ> Save

2. OR (Advanced - Drag & Drop):
   ‚îî‚îÄ> Drag video row
   ‚îî‚îÄ> Drop at new position
   ‚îî‚îÄ> Auto-update display_order
   ‚îî‚îÄ> Re-fetch list
```

---

## üéØ T·ªïng K·∫øt

### ‚úÖ ƒê√£ h·ªçc ƒë∆∞·ª£c:

1. **Video Model**: Simple schema without relationships
2. **YouTube Integration**: URL extraction, thumbnail generation
3. **Display Ordering**: Using display_order field
4. **Embed Player**: YouTube iframe integration
5. **Admin UI**: Table with thumbnail previews
6. **Public UI**: Grid with play button overlay
7. **Auto Features**: Auto-fill thumbnail, auto-extract video ID
8. **Status Management**: Active/Inactive toggle

### üìù Key Takeaways:

- ‚úÖ Videos ch·ªâ c·∫ßn YouTube URL, kh√¥ng c·∫ßn upload file
- ‚úÖ Thumbnail t·ª± ƒë·ªông t·ª´ YouTube API
- ‚úÖ Display order quan tr·ªçng h∆°n created_at
- ‚úÖ Embed iframe cho preview v√† public player
- ‚úÖ No slug, no views, no author
- ‚úÖ Status binary: active ho·∫∑c inactive

### üöÄ Advanced Features (Optional):

- Implement drag & drop ordering v·ªõi @dnd-kit
- YouTube API integration ƒë·ªÉ l·∫•y duration t·ª± ƒë·ªông
- Playlist support (nh√≥m videos)
- View count tracking
- Like/Share buttons
- Comments section

---

**Ch√∫c m·ª´ng!** üéâ B·∫°n ƒë√£ hi·ªÉu 100% Videos Management system!

*Last updated: November 28, 2025*
